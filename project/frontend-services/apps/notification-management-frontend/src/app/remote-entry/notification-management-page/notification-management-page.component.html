<div class="page">
  <button
    class="top-button"
    mat-stroked-button
    color="primary"
    (click)="openConfiguration()"
  >
    Configure Notifications
  </button>
  <button
    class="top-button"
    mat-stroked-button
    color="primary"
    (click)="search()"
  >
    Search Notifications During =>
  </button>
  <mat-form-field class="top-input">
    <mat-label>Enter a date range</mat-label>
    <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
      <input
        matStartDate
        formControlName="start"
        placeholder="Start date"
      />
      <input matEndDate formControlName="end" placeholder="End date"/>
    </mat-date-range-input>
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-date-range-picker #picker></mat-date-range-picker>
    <mat-error *ngIf="range.controls['start'].hasError('matStartDateInvalid')"
    >Invalid start date
    </mat-error
    >
    <mat-error *ngIf="range.controls['end'].hasError('matEndDateInvalid')"
    >Invalid end date
    </mat-error>
  </mat-form-field>
  <div class="table-container">
    <div class="container mat-elevation-z2">
      <table mat-table [dataSource]="sortedData" matSort multiTemplateDataRows
             (matSortChange)="sortData($event)">

        <ng-container matColumnDef="category">
          <th mat-sort-header="category" mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let element"> {{element.contentType.getCategory()}} </td>
        </ng-container>

        <ng-container matColumnDef="subCategory">
          <th mat-sort-header="subCategory" mat-header-cell *matHeaderCellDef>Sub Category</th>
          <td mat-cell *matCellDef="let element"> {{element.contentType.getSubCategory()}} </td>
        </ng-container>

        <ng-container matColumnDef="severity">
          <th mat-sort-header="severity" mat-header-cell *matHeaderCellDef>Severity</th>
          <td mat-cell *matCellDef="let element">
            <mat-icon matTooltip="{{element.contentType.severity}}"
                      [ngStyle]="{'color': element.contentType.getSeverityAsColor()}">circle
            </mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="reportedAt">
          <th mat-sort-header="reportedAt" mat-header-cell *matHeaderCellDef>Reported</th>
          <td mat-cell *matCellDef="let element"> {{element.timeAgo()}} ago</td>
        </ng-container>

        <ng-container matColumnDef="read">
          <th mat-sort-header="read" mat-header-cell *matHeaderCellDef>Read</th>
          <td mat-cell *matCellDef="let element">
            <mat-icon matTooltip="{{element.getReaders()}}" *ngIf="element.isRead()">done
            </mat-icon>
            <mat-icon matTooltip="{{element.getReaders()}}" *ngIf="!element.isRead()">clear
            </mat-icon>
          <td>
        </ng-container>

        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
            <div class="element-detail"
                 [@detailExpand]="element === expandedElement ? 'expanded' : 'collapsed'">
              <div class="element-description">
                <div class="description">
                  <span class="description-title">Description:</span>
                  <span class="description-content"> {{element.description}} </span>
                </div>
                <div class="description">
                  <button *ngIf="!notificationIsRead(element)" mat-stroked-button (click)="readNotification(element)">
                    <mat-icon>done</mat-icon>
                    <span>Mark as read</span>
                  </button>
                  <button [disabled]="true" *ngIf="notificationIsRead(element)" mat-stroked-button
                          (click)="readNotification(element)">
                    <mat-icon>done</mat-icon>
                    <span>Read</span>
                  </button>
                </div>
              </div>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let element; columns: displayedColumns;"
            class="element-row"
            [class.expanded-row]="expandedElement === element"
            (click)="expandedElement = expandedElement === element ? null : element">
        </tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row "></tr>
      </table>
    </div>
  </div>
</div>
